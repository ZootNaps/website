# Website Analytics & Tracking Setup: southlamarstudios.com

**Date of Setup:** 2024-07-26
**Primary Goal:** Implement robust analytics and tracking to understand visitor behavior, optimize for search engines (Google & AI Web Search), and attract new potential customers.

## I. Overall Strategy

The core strategy is to use **Google Tag Manager (GTM)** as a centralized system to manage all third-party tracking scripts (tags). This approach keeps the website's codebase cleaner, allows for easier tag deployment and updates, and improves site performance by managing how tags are loaded.

## II. Tools Implemented & Key IDs

1.  **Google Tag Manager (GTM)**
    *   **Purpose:** Tag management system.
    *   **Implementation:** Custom Next.js component (`src/utils/gtm.tsx`) loads the GTM container.
    *   **GTM Container ID:** `GTM-5QHBPGXM`
    *   **Environment Variable:** `NEXT_PUBLIC_GTM_ID=GTM-5QHBPGXM`

2.  **Google Analytics 4 (GA4)**
    *   **Purpose:** Website analytics, traffic analysis, user behavior tracking, conversion tracking.
    *   **Implementation:** Loaded via a "Google Tag" within Google Tag Manager.
    *   **GA4 Measurement ID:** `G-RGLV9ZVFF9`
    *   **Environment Variable (for reference, used in GTM setup):** `NEXT_PUBLIC_GA_MEASUREMENT_ID=G-RGLV9ZVFF9`
    *   **Note:** Direct GA4 loading via `src/utils/analytics.tsx` was commented out in `src/app/layout.tsx` to prevent double tracking.

3.  **Microsoft Clarity**
    *   **Purpose:** User behavior analytics, including session recordings, heatmaps (click, scroll), and insights into user frustrations (dead clicks, rage clicks).
    *   **Implementation:** Added as a "Custom HTML" tag within Google Tag Manager.
    *   **Clarity Project ID:** `rn5jv8yjak`

4.  **LinkedIn Insight Tag**
    *   **Purpose:** Enables website demographic insights for visitors who are LinkedIn members. Crucial for LinkedIn advertising (conversion tracking, retargeting).
    *   **Implementation:** Added using the "LinkedIn Insight" tag template within Google Tag Manager.
    *   **LinkedIn Partner ID:** `8423161`

## III. Key Code Files & Configuration Changes

1.  **`src/utils/gtm.tsx`**:
    *   New file created.
    *   Contains the `GoogleTagManager` React component.
    *   This component loads the GTM script (using `NEXT_PUBLIC_GTM_ID`) and includes the GTM `noscript` tag.
    *   It also pushes a `page_view` event to the `dataLayer` on route changes.
    *   Marked as `'use client';`.

2.  **`src/app/layout.tsx` (Root Layout)**:
    *   Imported and used the `GoogleTagManager` component, placed high in the `<body>`.
    *   The `GoogleTagManager` component is wrapped in `<Suspense fallback={null}>` to resolve a Next.js build issue related to `useSearchParams` when generating the 404 page.
    *   The direct call to the old `<GoogleAnalytics>` component was commented out.
    *   Imported `Suspense` from `react`.

3.  **`src/utils/analytics.tsx`**:
    *   The `GoogleAnalytics` component within this file is no longer actively used for pageview tracking (call is commented out in `layout.tsx`).
    *   The `trackEvent` function in this file was confirmed to not be in active use elsewhere in the project at the time of GTM setup.

4.  **`src/middleware.ts`**:
    *   The Content Security Policy (CSP) was updated to include necessary Google domains (`*.googletagmanager.com`, `tagassistant.google.com`, `*.google.com`, `*.google-analytics.com`) to ensure GTM and Google Tag Assistant (for debugging) function correctly.

5.  **Environment Variables (`.env.local` and Vercel)**:
    *   `NEXT_PUBLIC_GTM_ID=GTM-5QHBPGXM` (Added and required)
    *   `NEXT_PUBLIC_GA_MEASUREMENT_ID=G-RGLV9ZVFF9` (Retained for reference and GTM configuration)

6.  **`src/app/_not-found/page.tsx`**:
    *   This file was deleted as it was suspected to be part of a build issue, and the standard `src/app/not-found.tsx` is the conventional way to handle 404 pages in Next.js App Router.

## IV. Accessing and Utilizing Data

1.  **Google Analytics 4 (GA4):**
    *   **Access:** [analytics.google.com](https://analytics.google.com) (select your property).
    *   **Key Uses:** Traffic sources, page performance, user engagement, audience demographics, conversion tracking (if set up), Search Console integration for SEO query data.

2.  **Microsoft Clarity:**
    *   **Access:** [clarity.microsoft.com](https://clarity.microsoft.com) (select your project).
    *   **Key Uses:** Watch session recordings, analyze heatmaps (click, scroll) to identify UX issues, dead clicks, rage clicks, and understand user interaction patterns.

3.  **LinkedIn Insight Tag (Website Demographics):**
    *   **Access:** [linkedin.com/campaignmanager](https://linkedin.com/campaignmanager) -> Your Ad Account -> Account Assets -> Website Demographics.
    *   **Key Uses:** Understand the professional demographics (job titles, industries, company size, etc.) of your website visitors. Validate target audience and inform content strategy. Essential for LinkedIn Ads.

## V. Build Issue Resolution

*   A Vercel build error `useSearchParams() should be wrapped in a suspense boundary at page "/404"` was encountered.
*   This was resolved by wrapping the `<GoogleTagManager />` component (which uses `useSearchParams` internally) within a `<Suspense fallback={null}>` boundary in `src/app/layout.tsx`.

This document should serve as a good overview of the current tracking setup. Remember to regularly check the respective analytics platforms to monitor data and gain insights.